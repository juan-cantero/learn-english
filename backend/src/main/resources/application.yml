spring:
  application:
    name: learntv-api

  profiles:
    active: dev

server:
  port: 8080

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: method

# External API configurations
external-apis:
  tmdb:
    api-key: ${TMDB_API_KEY:}
    base-url: https://api.themoviedb.org/3
  opensubtitles:
    api-key: ${OPENSUBTITLES_API_KEY:}
    base-url: https://api.opensubtitles.com/api/v1
    user-agent: LearnTV v1.0
  openai:
    api-key: ${OPENAI_API_KEY:}
    base-url: https://api.openai.com/v1
    model: gpt-4o-mini
    max-tokens: 4000
  piper:
    model-path: ${PIPER_MODEL_PATH:${user.home}/.local/share/piper/en_US-lessac-medium.onnx}
    timeout-seconds: 10
    ffmpeg-quality: 6

# Supabase Auth
supabase:
  jwt:
    secret: ${SUPABASE_JWT_SECRET:}
    issuer: ${SUPABASE_URL:https://localhost}/auth/v1

# Cloudflare R2 Storage
cloudflare:
  r2:
    account-id: ${CLOUDFLARE_ACCOUNT_ID:}
    access-key-id: ${R2_ACCESS_KEY_ID:}
    secret-access-key: ${R2_SECRET_ACCESS_KEY:}
    bucket-name: ${R2_BUCKET_NAME:learntv-audio}
    public-url: ${R2_PUBLIC_URL:https://audio.learntv.example.com}

---
# Development profile - PostgreSQL via Docker
spring:
  config:
    activate:
      on-profile: dev

  datasource:
    url: jdbc:postgresql://localhost:5433/learntv
    username: learntv
    password: learntv_dev
    driver-class-name: org.postgresql.Driver

  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate
    show-sql: true
    properties:
      hibernate:
        format_sql: true

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration

# Local audio storage for dev
audio:
  local:
    storage-path: ${AUDIO_LOCAL_PATH:${java.io.tmpdir}/learntv-audio}
    base-url: http://localhost:8080/api/v1/audio

# Mock auth for development
auth:
  mock:
    enabled: true
    default-user-id: "00000000-0000-0000-0000-000000000001"
    default-email: "dev@learntv.local"
    default-role: LEARNER

---
# Test profile - H2 in-memory (for tests and quick runs)
spring:
  config:
    activate:
      on-profile: test

  datasource:
    url: jdbc:h2:mem:learntvdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MODE=PostgreSQL
    driver-class-name: org.h2.Driver
    username: sa
    password:

  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: validate
    show-sql: true

  flyway:
    enabled: true
    locations: classpath:db/migration

  h2:
    console:
      enabled: true
      path: /h2-console

---
# Production profile - External PostgreSQL (Supabase)
spring:
  config:
    activate:
      on-profile: production

  datasource:
    url: ${DATABASE_URL}
    driver-class-name: org.postgresql.Driver

  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate
    show-sql: false

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration

  h2:
    console:
      enabled: false

# Disable mock auth in production
auth:
  mock:
    enabled: false

---
# Local Supabase profile - Uses local Docker Supabase for auth
spring:
  config:
    activate:
      on-profile: local-supabase

  datasource:
    url: jdbc:postgresql://localhost:5433/learntv
    username: learntv
    password: learntv_dev
    driver-class-name: org.postgresql.Driver

  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate
    show-sql: true
    properties:
      hibernate:
        format_sql: true

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration

# Local Supabase configuration
supabase:
  jwt:
    secret: super-secret-jwt-token-with-at-least-32-characters-long
    issuer: http://127.0.0.1:54321/auth/v1
    # EC public key for ES256 (local Supabase default)
    ec-public-key-x: M5Sjqn5zwC9Kl1zVfUUGvv9boQjCGd45G8sdopBExB4
    ec-public-key-y: P6IXMvA2WYXSHSOMTBH2jsw_9rrzGy89FjPf6oOsIxQ

# Disable mock auth - use real Supabase
auth:
  mock:
    enabled: false

# Local audio storage
audio:
  local:
    storage-path: ${AUDIO_LOCAL_PATH:${java.io.tmpdir}/learntv-audio}
    base-url: http://localhost:8080/api/v1/audio
